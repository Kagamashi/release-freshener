<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>GitHub Main Releases</title>

  <!-- Bootstrap 5 CSS via CDN -->
  <link 
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
    integrity="sha384-ENjdO4Dr2bkBIFxQpeo9Z/hh5c+G3GoOT6eNyVw6V9UfXGdZajp+STV8f2Hzhk25"
    crossorigin="anonymous"
  />

  <style>
    body {
      font-family: sans-serif;
      background-color: #f8f9fa;
    }
    .table thead {
      background-color: #574b90;
      color: #fff;
    }
    table {
      table-layout: fixed;
      word-wrap: break-word;
    }
    th:nth-child(1) { width: 25%; }
    th:nth-child(2) { width: 15%; }
    th:nth-child(3) { width: 20%; }
    th:nth-child(4) { width: 40%; }
  </style>
</head>
<body>

<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
  <div class="container-fluid">
    <a class="navbar-brand" href="#">Releases Dashboard</a>
  </div>
</nav>

<div class="container my-4">
  <div class="row mb-3">
    <div class="col">
      <h1 class="h3">GitHub Main Releases</h1>
      <p class="text-muted mb-0">
        Sorted by date (newest first). Search by <strong>Repository</strong> or <strong>Tag</strong>.
      </p>
    </div>
  </div>

  <div class="row mb-3">
    <div class="col-12 col-sm-6">
      <label for="search-box" class="form-label">Search (repo or tag):</label>
      <input 
        type="text" 
        id="search-box" 
        class="form-control" 
        placeholder="e.g., kubernetes, v1.2.3..."
      />
    </div>
  </div>

  <div class="table-responsive">
    <table class="table table-hover align-middle" id="release-table">
      <thead>
        <tr>
          <th scope="col">Repository</th>
          <th scope="col">Tag</th>
          <th scope="col">Published</th>
          <th scope="col">Link</th>
        </tr>
      </thead>
      <tbody id="release-body">
        <!-- Populated by JS -->
      </tbody>
    </table>
  </div>
</div>

<script>
  let releases = [];

  document.addEventListener("DOMContentLoaded", init);

  function init() {
    document.getElementById("search-box").addEventListener("input", handleSearch);
    loadReleases();
  }

  async function loadReleases() {
    try {
      // Adjust path to your JSON if needed
      const response = await fetch("./data/releases.json");
      if (!response.ok) {
        throw new Error(`HTTP ${response.status} - ${response.statusText}`);
      }
      releases = await response.json();

      // Sort by date descending
      sortByDateDesc(releases);

      // Render all
      renderTable(releases);
    } catch (err) {
      const tbody = document.getElementById("release-body");
      tbody.innerHTML = `<tr><td colspan="4" class="text-danger fw-bold">Error: ${err.message}</td></tr>`;
    }
  }

  function sortByDateDesc(arr) {
    arr.sort((a, b) => {
      const [dayA, monthA, yearA] = a.published_at.split("-").map(Number);
      const dateA = new Date(yearA, monthA - 1, dayA);

      const [dayB, monthB, yearB] = b.published_at.split("-").map(Number);
      const dateB = new Date(yearB, monthB - 1, dayB);

      return dateB - dateA; // newest first
    });
  }

  function renderTable(data) {
    const tbody = document.getElementById("release-body");
    tbody.innerHTML = "";

    data.forEach(item => {
      const row = document.createElement("tr");
      row.innerHTML = `
        <td>${item.owner}/${item.repo}</td>
        <td>${item.tag_name}</td>
        <td>${item.published_at}</td>
        <td><a href="${item.html_url}" target="_blank" class="btn btn-primary btn-sm">View</a></td>
      `;
      tbody.appendChild(row);
    });
  }

  function handleSearch() {
    const query = document.getElementById("search-box").value.trim().toLowerCase();

    if (!query) {
      // If search is empty, show all
      renderTable(releases);
      return;
    }

    // Filter by repo or tag
    // We'll combine "owner/repo" into a single string to compare
    const filtered = releases.filter(item => {
      const repoFull = (item.owner + "/" + item.repo).toLowerCase();
      const tag = item.tag_name.toLowerCase();

      return repoFull.includes(query) || tag.includes(query);
    });

    renderTable(filtered);
  }
</script>

</body>
</html>
